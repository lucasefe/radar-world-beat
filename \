/* global google:true, document: true, window: true, RadarClient: true */
var configuration = {
      host: 'localhost',
      port: 8000,
      secure: false,
      userId: 1,
      userType: 2,
      accountName: 'test'
    },
    mapOptions = {
      center: { lat: 37.7749300, lng: -122.4194200},
      zoom: 13
    },
    markers = [],
    map;

var forEachClient = function(data) {

      Object.keys(data.value).forEach(function(userId) {
        Object.keys(data.value[userId].clients).forEach(function(clientId) {
        });
      });
};
var drawMarkerOnMap = function(map, data) {
  if (!data) { return; }

  var infowindow = new google.maps.InfoWindow({ content: 'Client: ' + data.name }),
      location = new google.maps.LatLng(data.lat, data.lng),
      marker = new google.maps.Marker({ position: location, map: map });

  google.maps.event.addListener(marker, 'click', function() {
    infowindow.open(map,marker);
  });

  markers.push(marker);

  return location;
};

var initializeMap = function() {

  map = new google.maps.Map(document.getElementById('map-canvas'), mapOptions);
};

google.maps.event.addDomListener(window, 'load', initializeMap);

document.addEventListener('DOMContentLoaded', function() { 
  RadarClient.configure(configuration).alloc('map', function() {
    RadarClient.presence('map').on(function(data){
      drawMarkerOnMap(map, data.value.clientData);
    }).sync({version: 2}, function(data) {
      forEachClient(data, function(clientId, data) {
        drawMarkerOnMap(map, data); 
      });
    });
  });
});
